[{"content":"0x00 題目說明 請利用 CDX 系統創建兩個虛擬機 VM1(CDX_Kali_Linux-2020.4-TMPL-custom)、VM2(CDX-Metasploitable2-TMPL-custom) 分別作為攻擊機和靶機，並執行下列操作：\n使用 VM1 收集 VM2 的系統資訊，並說明收集到的內容 使用 Wireshark 收集網路流量 使用 VM1 取得 VM2 的管理員權限，進入系統並顯示 VM2 的網路配置 將 VM2 更改為 CDX-OWASP-BWA-TMPL-custom，然後使用 VM1 進行弱點掃描，找出並說明 VM2 上的漏洞 0x01 使用 VM1 收集 VM2 的系統資訊，並說明收集到的內容 創建 VM1 和 VM2 ，這邊攻擊機用的是 2024.1 版： 收集靶機資訊： 先用 nmap 進行主動掃描，並將結果保存\nkali@kali:~$sudo nmap 10.98.0.118 -p- -A -oN nmap_10.98.0.118 \u0026#34;-p-\u0026#34;: 掃描所有連接埠 (範圍0~65535) \u0026#34;-A\u0026#34;: 侵入式掃描，同時執行作業系統檢測、版本檢測、腳本掃描和 Traceroute \u0026#34;-oN\u0026#34;: 將掃描結果保存到指定文件 (nmap_10.98.0.118) 中 整理之後如下\n主機基本信息： * IP Address: 10.98.0.118 * MAC Address: 02:00:0A:62:00:76 * OS: Linux 2.6.9 - 2.6.33 * Hostname: metasploitable.localdomain * Domain Name: localdomain * 網路距離: 1 hop 開放的連接埠和服務 1. 21/tcp - ftp: vsftpd 2.3.4 2. 22/tcp - ssh: OpenSSH 4.7p1 Debian 8ubuntu1 3. 23/tcp - telnet?: 可能運行 Telnet 服務 4. 25/tcp - smtp?: SMTP 連接埠，但無法連接 5. 53/tcp - domain: ISC BIND 9.4.2 (DNS 伺服器) 6. 80/tcp - http: Apache httpd 2.2.8 (Ubuntu) 7. 139/tcp - netbios-ssn: Samba smbd 3.X - 4.X 8. 445/tcp - netbios-ssn: Samba smbd 3.0.20-Debian 9. 512/tcp - exec? 10. 513/tcp - login? 11. 514/tcp - shell? 12. 1099/tcp - java-rmi: GNU Classpath grmiregistry 13. 1524/tcp - bindshell: Metasploitable root shell 14. 2121/tcp - ccproxy-ftp? 15. 3306/tcp - mysql? 16. 3632/tcp - distccd: distccd v1 (GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4) 17. 5432/tcp - postgresql: PostgreSQL DB 8.3.0 - 8.3.7 18. 5900/tcp - vnc: VNC (protocol 3.3) 19. 6000/tcp - X11: 拒絕訪問 20. 6667/tcp - irc: UnrealIRCd 21. 6697/tcp - irc: UnrealIRCd 22. 8009/tcp - ajp13: Apache Jserv (Protocol v1.3) 23. 8180/tcp - http: Apache Tomcat/Coyote JSP engine 1.1 24. 8787/tcp - drb: Ruby DRb RMI (Ruby 1.8) 25. 56283/tcp - java-rmi: GNU Classpath grmiregistry 26. 111/tcp \u0026amp; 111/udp - rpcbind: 用於管理和註冊 RPC 服務 27. 2049/tcp \u0026amp; 2049/udp - nfs: 網路檔案系統 28. 39142/tcp \u0026amp; 40577/udp - status: NFS 鎖管理器 29. 47929/tcp \u0026amp; 50178/udp - nlockmgr: 系統狀態服務 30. 56842/tcp \u0026amp; 38894/udp - mountd: NFS 掛載服務 再來用 dirb 爆破💣靶機目錄，後面可能會用到\nkali@kali:~$ dirb 10.98.0.118 0x02 使用 Wireshark 收集網路流量 Wireshark 捕獲的部分封包截圖： 這邊已經過濾出源地址或目標地址為 VM1 或 VM2 的所有封包，可以看到攻擊機在進行主動掃描的時候，靶機其實也能捕捉到有人想要偷做壞事 0x03 使用 VM1 取得 VM2 的管理員權限，進入系統並顯示 VM2 的網路配置 ★ 目標: 取得靶機 root 權限，並顯示網路配置 ★ Metasploitable 2 本身就是專門設計用來安全研究和漏洞測試的虛擬機，所以上面包含了大量已知的漏洞和錯誤配置 雖然本題只要求提權而已，但這邊還是把我找到的其它漏洞也一併列出 🐛\n1. 1524/tcp - bindshell: Metasploitable root shell 說明：superuser shell 在 port 1524 上可用 修復方法：禁用此連接埠 kali@kali:~$ nc 10.98.0.118 1524 2. 512, 513, 514/tcp - R Services 說明：port 512、513、514 被稱為 R Services，這邊因為設定錯誤，不用密碼也可遠端登入系統 修復方法：禁用此服務或設定防火牆 kali@kali:~$ rlogin -l root 10.98.0.118 3. 21/tcp - ftp: vsftpd 2.3.4 (CVE-2011-2523) 說明：vsftpd 2.3.4 存在後門 (Backdoor) 漏洞，另外這個版本因為設計上的失誤，在用戶名帶有 :) 時會自動打開 port 6200，俗稱笑臉漏洞 修復方法：更新 FTP 版本 CVE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2523 Exploit Database: https://www.exploit-db.com/exploits/49757 kali@kali:~$ msfconsole msf6 \u0026gt; msf6 \u0026gt; use exploit/unix/ftp/vsftpd_234_backdoor msf6 exploit(unix/ftp/vsftpd_234_backdoor) \u0026gt; set RHOST 10.98.0.118 msf6 exploit(unix/ftp/vsftpd_234_backdoor) \u0026gt; run 4. 6667/tcp - UnrealIRCd (CVE-2010-2075) 說明：UnrealIRCd 3.2.8.1 存在後門 (Backdoor) 漏洞 修復方法：更新 IRC 版本 CVE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=2010-2075 Exploit Database: https://www.exploit-db.com/exploits/16922 kali@kali:~$ msfconsole msf6 \u0026gt; msf6 \u0026gt; use exploit/unix/irc/unreal_ircd_3281_backdoor msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) \u0026gt; set RHOST 10.98.0.118 msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) \u0026gt; run 5. 139, 445/tcp - netbios-ssn: Samba smbd 3.X - 4.X (CVE-2007-2447) 說明：Samba 3.0.20 - 3.0.25 存在遠端程式碼執行 (RCE) 漏洞 修復方法：更新 Samba 版本 CVE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-2447 Exploit Database: https://www.exploit-db.com/exploits/16320 kali@kali:~$ msfconsole msf6 \u0026gt; msf6 \u0026gt; use exploit/multi/samba/usermap_script msf6 exploit(multi/samba/usermap_script) \u0026gt; set RHOST 10.98.0.118 msf6 exploit(multi/samba/usermap_script) \u0026gt; run 6. 23/tcp - telent 說明：telent 是一種未加密的應用層傳輸協議，可能導致敏感資料被監聽，這邊登入的帳密 msfadmin:msfamin，是從第 7 點的 ssh 密碼爆破得知 修復方法：除非有特殊需求，不然應該禁用此服務 kali@kali:~$ telnet 10.98.0.118 ★ 其他漏洞 ★ 再來幾乎都是弱密碼和一些配置錯誤\n7. 22/tcp - ssh 說明：弱密碼。 爆破得知三組使用者和密碼：1.user : user 2.msfadmin : msfamin 3.postgres : postgres 修復方法：更改為強密碼 9. 25/tcp - SMTP 說明：SMTP 連接埠不受保護 修復方法：禁用此服務或設定防火牆\n6. 80/tcp - Apache/2.2.8 + PHP/5.2.4 (cve-2012-1823) 說明：根據前面 dirb 找到的 phpinfo.php 頁面http://10.98.0.118/mutillidae/phpinfo.php，得知靶機 PHP 版本存在遠端程式碼執行 (RCE) 漏洞 修復方法：更新 PHP 版本，刪除 phpinfo.php 頁面 CVE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1823 Exploit Database: https://www.exploit-db.com/exploits/29290 得到 meterpreter 並允許使用 www-data 使用者的 shell，但沒有完成提權，無法使用所有命令\n10. 1099, 56283/tcp - java-rmi (CVE-2011-3556) 說明：port 1099 存在緩衝區溢位 (Buffer Overflow) 漏洞 修復方法：更新 java 版本 msfconsole 利用失敗，提示 \u0026ldquo;Exploit completed, but no session was created.\u0026rdquo;\n11. 3306/tcp - MySQL 說明：弱密碼。 root 用戶沒有設定密碼，外部可以直接以超級使用者權限連接資料庫 修復方法：更改為強密碼 12. 5432/tcp - postgresql 說明：弱密碼。 爆破得知一組使用者和密碼: login: postgres / password: postgres 修復方法：更改為強密碼 13. 5900/tcp - VNC 說明：弱密碼。 爆破得知一組使用者和密碼: login: root / password: password 修復方法：更改為強密碼 14. Linux Kernel 2.6.24 (CVE-2008-0900, CVE-2009-0065, CVE-2008-0600, CVE-2009-1046) 說明：靶機 kernel 版本過舊，存在漏洞 修復方法：更新 kernel 15. msfadmin 帳戶 說明：msfadmin 帳戶被賦予 root 權限，且密碼容易破解 (第 7 項) 修復方法：更改為強密碼，並移除不必要的權限 到這邊為止大概列出了 15 項 Metasploitable 2 靶機上的漏洞，但實際上一定存在更多 💩\n0x04 將 VM2 更改為 CDX-OWASP-BWA-TMPL-custom，然後使用 VM1 進行弱點掃描，找出並說明 VM2 上的漏洞 創建 CDX-OWASP-BWA-TMPL-custom： 收集靶機資訊： 再來一樣用 nmap 掃描，但是這裡多帶一個 --script 參數\nkali@kali:~$sudo nmap 10.98.0.117 -p- --script=vuln -oN nmap_10.98.0.117 \u0026#34;-p-\u0026#34;: 掃描所有連接埠 (範圍0~65535) \u0026#34;--script=vuln\u0026#34;: 執行漏洞檢測腳本，針對漏洞進行檢測和報告 \u0026#34;-oN\u0026#34;: 將掃描結果保存到指定文件 (nmap_10.98.3.117) 中 整理後如下\n主機基本信息： * IP Address: 10.98.0.117 * MAC Address: 02:00:0A:62:00:75 * OS: Linux 2.6.17 - 2.6.36 開放的連接埠和服務： 1. 22/tcp - ssh: OpenSSH 5.3p1 Debian 3ubuntu4 (protocol 2.0) 2. 80/tcp - http: Apache httpd 2.2.14 (Ubuntu) 3. 139/tcp - netbios-ssn: Samba smbd 3.X - 4.X 4. 143/tcp - imap: Courier Imapd 5. 443/tcp - https: Apache httpd 2.2.14 (Ubuntu) 6. 445/tcp - netbios-ssn: Samba smbd 3.X - 4.X 7. 5001/tcp - java-object: Java Object Serialization 8. 8080/tcp - http-proxy: Apache Tomcat/Coyote JSP engine 1.1 9. 8081/tcp - blackice-icecap: Jetty 6.1.25 漏洞掃描結果： 1. 80/tcp - http 可能存在漏洞: 1. CSRF 漏洞 2. DOM-based XSS 漏洞 3. 內部 IP 洩漏 4. HTTP TRACE 已啟用 2. 443/tcp - https 可能存在漏洞: 1. CSRF 漏洞 2. DOM-based XSS 漏洞 3. POODLE 漏洞 4. crossdomain.xml 設定不當 3. 8080/tcp - http-proxy 可能存在漏洞: 1. Cookie 的 HttpOnly 未啟用 2. Apache Tomcat 的 401 未經授權訪問 3. 文件和目錄資訊洩漏 4. CVE * CVE-2011-3192: Apache byterange filter DoS漏洞 * CVE-2014-3566: POODLE 漏洞 * CVE-2014-0224: SSL/TLS CCS Injection 漏洞 以上是 nmap 漏洞腳本掃描之後的結果\n0x05 後記 最後的 0x04 因為題目沒有要求，所以我也沒去驗證，可能存在誤報 (False Positives) 的情況。但其實除了主機本身的弱點外，OWASP-BWA 和 Metasploitable 2 上還有很多用於練習的場景，例如 DVWA 或 WebGoat 等等，之後有空也可以來打看看。\n","permalink":"https://KONI-code2023.github.io/blog/code-assignment06/","summary":"0x00 題目說明 請利用 CDX 系統創建兩個虛擬機 VM1(CDX_Kali_Linux-2020.4-TMPL-custom)、VM2(CDX-Metasploitable2-TMPL-custom) 分別作為攻擊機和靶機，並執行下列操作：\n使用 VM1 收集 VM2 的系統資訊，並說明收集到的內容 使用 Wireshark 收集網路流量 使用 VM1 取得 VM2 的管理員權限，進入系統並顯示 VM2 的網路配置 將 VM2 更改為 CDX-OWASP-BWA-TMPL-custom，然後使用 VM1 進行弱點掃描，找出並說明 VM2 上的漏洞 0x01 使用 VM1 收集 VM2 的系統資訊，並說明收集到的內容 創建 VM1 和 VM2 ，這邊攻擊機用的是 2024.1 版： 收集靶機資訊： 先用 nmap 進行主動掃描，並將結果保存\nkali@kali:~$sudo nmap 10.98.0.118 -p- -A -oN nmap_10.98.0.118 \u0026#34;-p-\u0026#34;: 掃描所有連接埠 (範圍0~65535) \u0026#34;-A\u0026#34;: 侵入式掃描，同時執行作業系統檢測、版本檢測、腳本掃描和 Traceroute \u0026#34;-oN\u0026#34;: 將掃描結果保存到指定文件 (nmap_10.98.0.118) 中 整理之後如下\n主機基本信息： * IP Address: 10.98.0.118 * MAC Address: 02:00:0A:62:00:76 * OS: Linux 2.","title":"網路攻防實務 (六) - 滲透測試"},{"content":"","permalink":"https://KONI-code2023.github.io/blog/code-assignment05/","summary":"","title":"網路攻防實務 (五) - DDoS 攻擊"},{"content":"","permalink":"https://KONI-code2023.github.io/blog/code-assignment04/","summary":"","title":"網路攻防實務 (四) - ubuntu 防火牆設定"},{"content":"","permalink":"https://KONI-code2023.github.io/blog/code-assignment03/","summary":"","title":"網路攻防實務 (三) - 流量分析"},{"content":"","permalink":"https://KONI-code2023.github.io/blog/code-assignment02/","summary":"","title":"網路攻防實務 (二) - 安裝 Apache2 伺服器"},{"content":"0x00 題目說明 請利用 CDX 系統創建兩個虛擬機 VM1(CDX_Kali_Linux-2020.4-TMPL-custom)、VM2(CDX-Metasploitable2-TMPL-custom) 分別作為攻擊機和靶機，並執行下列操作：\n使用 VM1 收集 VM2 的系統資訊，並說明收集到的內容 使用 Wireshark 收集網路流量 使用 VM1 取得 VM2 的管理員權限，進入系統並顯示 VM2 的網路配置 將 VM2 更改為 CDX-OWASP-BWA-TMPL-custom，然後使用 VM1 進行弱點掃描，找出並說明 VM2 上的漏洞 0x01 使用 VM1 收集 VM2 的系統資訊，並說明收集到的內容 ","permalink":"https://KONI-code2023.github.io/blog/code-assignment01/","summary":"0x00 題目說明 請利用 CDX 系統創建兩個虛擬機 VM1(CDX_Kali_Linux-2020.4-TMPL-custom)、VM2(CDX-Metasploitable2-TMPL-custom) 分別作為攻擊機和靶機，並執行下列操作：\n使用 VM1 收集 VM2 的系統資訊，並說明收集到的內容 使用 Wireshark 收集網路流量 使用 VM1 取得 VM2 的管理員權限，進入系統並顯示 VM2 的網路配置 將 VM2 更改為 CDX-OWASP-BWA-TMPL-custom，然後使用 VM1 進行弱點掃描，找出並說明 VM2 上的漏洞 0x01 使用 VM1 收集 VM2 的系統資訊，並說明收集到的內容 ","title":"網路攻防實務 (一) - 系統檢測"}]